# 05/29 기술 스터디

작성 일시: 2024년 5월 29일 오후 6:58
최종 편집 일시: 2024년 5월 29일 오후 7:42
작성자: 김진영
참석자: 재욱 김, 명훈, 김진영
상태: Backlog

## 이번시간

- **프런트엔드 개발을 위한 보안 입문**
- ‘Chapter 6. 기타 수동적인 공격 : CSRF, 클릭재킹, 오픈 리다이렉트’ 까지 읽어보고 오기.

- CSRF는 사용자의 권한 등이 필요한 처리를 강제로 실행하는 공격이다.
- CSRF 대책은 요청이 정상인지를 확인하는 방식과 브라우저의 기능을 사용한다
- 클릭재킹은 사용자를 속여 버튼과 링크를 클릭하도록 하는 공격을 말한다.
- 클랙재킹 방지를 위해 iframe을 사용해 페이지를 삽입하는 것을 금지한다.
- 오픈 리다이렉트는 이동（리다이렉트） 기능을 악용해 정상 웹 애플리케이션에서 피싱 사이트로 이동시키는 공격이다.
- 오픈 리다이렉트는 이동 대상인 URL올 체크해 방지한다

XSS 이외의  대표적인 수동 공격 세 가지를 살펴본다. CSRF, 클릭재킹，오픈 리다이렉트는 XSS에 비해 발생 건수가 적고 위험도도 낮은 공격이다.

- CSRF(cross site request forgery)
    
    공격자가 준비한 함정에 의해 웹 애플리케이션이 원래 갖고 있는 기능이 사용자의 의도와 상관없이 호출되는 공격이다.
    
    ### CSRF의 구조
    
    <form> 요소로 전송되는 요청은 동일 출처 정책에 의해 제한되지 않는다.
    또한 요청하는 은행 사이트의 쿠키가 브라우저에 저장되어 있으면 피싱 사이트에서 요청을 전송할 때도 은행 사이트의 쿠키가 포함된다. 
    은행 사이트의 서버는 요청에 포함된 쿠키를 기반으로 요청을 전송한 사용자를 정상으로 인식한다.
    
    ### 토큰을 사용하는 CSRF 대책
    
    페이지 접근 요청을 받은 서버는 랜덤 문자열 토큰을 생성해 세션별로 서버에 보관한 후 보유한 토큰을 **HTML에 삽입**한다.
    
    그리고 폼을 전송할 때 이 토큰을 함께 전송한다.
    
    서버는 요청에 포함된 토큰과 세션에 보관된 토큰이 일치하는지를 확인하고，일치하지 않으면 잘못된 요청으로 간주한다.
    
    ### Double Submit 쿠키를 사용하는 CSRF 대책
    
    Double Submit 쿠키는 세션용 쿠키에 더해 **랜덤 토큰 값을 가진 쿠키를 따로 발행**하고 이 토큰을 사용해 정상적인 요청인지를 확인하는 CSRF 대책이다.
    
    ### SameSite 쿠키를 사용하는 CSRF 대책
    
    로그인된 세션 정보가 들어있는 쿠키를 전송하지 않으면 대부분의 CSRF 공격을 막을 수 있다.
    SameSite 쿠키는 쿠키의 전송을 제어하는 기능으로 쿠키 전송을 동일한 사이트로 제한할 수 있다.
    
    SameSite 쿠키를 사용하려면 Set-Cookie 헤더에 쿠키를 설정할 때 SameSite 속성을 지정한다.
    
    ### Origin 헤더를 사용하는 CSRF 대책
    
    HTML믈 전송하는 서버와 API를 제공하는 서버가 다르면 HTML에 원타임 토큰을 포함해도 API 서버는 해당값의 유효성을 확인할 수 없다. 그러나 API를 제공하는 서버에서 Origin 헤더를 확인하면 허가되지 않은 출처의 요청을 금지할 수 있으므로 CSRF 대책이 된다.
    
    ### CORS를 사용하는 CSRF 대책
    
    CORS의 Preflight Request에서 요청 내용을 확인하면 의도하지 않은 fetch 함
    수와 XHR의 요청을 방지할 수 있다.
    
    다만 Preflight Request는 요청 횟수가 늘어나므로 성능에 좋지 않다는 의견도 있다.
    다른 방법으로 해결할 수 없을 때 검토하도록 하자.
    
- 클릭재킹(clickjacking)
    
    클릭재킹이란 사용자의 의도와는 다르게 버튼과 링크 등을 클릭하게 해 의도하지 않은 처리를 실행하도록 하는 공격이다.
    
    ### 클릭재킹의 구조
    
    클릭재킹    공격은   i打ame을  사용한  교차  출처    페이지의    삽입과  사용자에   의한  클릭에    의해    발생한다.
    구체적인    방법은   다음과  같다.
    
    1. 공격 대상의 웹 애플리케이션 페이지를 i打ame을 사용해 피싱 사이트와 중첩시킨다.
    2. CSS를 사용해 iframe을 투명하게 해 사용자에게 보이지 않게 한다.
    3. 이하 생략
    
    ### 클릭재킹 대책
    
    클릭재킹을 막으려면 i打ame과 같이 프레임에 페이지를 삽입하는 것을 제한해야 한다.
    
    프레임 안에 삽입을 제한하려면 응답에 frame-ancestors의 directive를 사용해 CSP헤더를 포함해야 한다.
    
    - CSP frame-ancestors
        
        CSP의    frame-ancestors directive는 프레임     내부에   페이지    삽입을  제한한다.
        
        - Content-Security-Policy：       frame-ancestors 'none’
            
            모든  출처의    프레임    내부에   해당  페이지의   삽입을   제한한다.
            
        - Content-Security-Policy：       frame-ancestors ‘self’
            
            교차  출처의    프레임    내부에   삽입을  제한한다.
            
        - Content-Security-Policy：       frame-ancestors uri
            
            지정한 출처의 프레임 내부에 삽입을 허가한다.
            
- 오픈 리다이렉트
    
    오픈 리다이렉트는 사용자가 정상적인 사이트에 접속하려고 하더라도 강제로 피싱 사이트로 리다이렉트되는 특징이 있다.
    
    ### 오픈 리다이렉트의 구조
    
    오픈 리다이렉트의 취약점이 있을 때는 다음과 같이 예상하지 않은 외부 웹사이트의 URL이 설정되면 웹사이트로 리다이렉션이 되어버린다.
    
    `https-[//site.example/login?url=**https://attacker.example**](https://site.example/login?url=https7/attacker.example)`
    
    보통 오픈 리다이렉트는 요청에 포함된 URL 문자열 파라미터를 서버에서 리다이렉트 URL로 사용하기 때문에 발생한다.
    
    ### URL 검사를 통한 오픈 리다이렉트 대책
    
    오픈 리다이렉트는 외부에서 파라미터에 지정된 URL을 그대로 사용해 페이지를 이동하기 때문에 발생한다.
    
    오픈 리다이렉트를 방지하려면 외부에서 입력한 URL을 체크해야 한다. 이동하려는 페이지가 특정 URL로만 정해져 있다면 URL이 특정 URL에 해당하는지 체크하는 것으로 해결할 수 있다
    
    외부에서    입력된    URL을  사용해    이동   기능을  구현할  때는   URL을  체크해야  한다.
    

## 다음 시간 :   6/05 수  저녁 7시

- ‘Chapter 7. 인증, 인가’ , ‘Chapter 8. 라이브러리를 노린 보안 리스크’  까지 읽어보고 오기.
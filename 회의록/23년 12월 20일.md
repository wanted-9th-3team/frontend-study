# 12/20 ê¸°ìˆ  ìŠ¤í„°ë””

ì‘ì„± ì¼ì‹œ: 2023ë…„ 12ì›” 17ì¼ ì˜¤í›„ 10:38
ìµœì¢… í¸ì§‘ ì¼ì‹œ: 2023ë…„ 12ì›” 20ì¼ ì˜¤í›„ 2:35
ì‘ì„±ì: myung hun kang
ìƒíƒœ: Backlog

# ìš°ì•„í•œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸

## 7. ë¹„ë™ê¸° í˜¸ì¶œ

## 7.1 API ìš”ì²­

**fetchë¡œ APIìš”ì²­í•˜ê¸°**

**ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ê¸°**

- API ìš”ì²­ ì •ì±…ì— ë³€ê²½ì´ ìƒê²¨ ì½”ë“œê°€ ë³€ê²½ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ê°ì•ˆí•˜ë©´, ë¹„ë™ê¸° í˜¸ì¶œ ì½”ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ì˜ì—­ì—ì„œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ê·¸ì¹˜ë§Œ ê¸°ëŠ¥ì— ë”°ë¼ ë¶„ë¦¬í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°ê°€ ìˆë‹¤.
    - fetchì—ì„œ íƒ€ì…ì•„ì›ƒ ì„¤ì •
    
    ```tsx
    async function fetchCart(){
    	const controller = new AbortController();
    	
    	const timeoutId = setTimeout(()=> controller.abort(), 5000);
    
    	return await fetch("https://api.baemin.com/cart",{
    		signal: controller.signal,
    	});
    }
    ```
    

**Axios í™œìš©í•˜ê¸°** 

- fetchì˜ ë²ˆê±°ë¡œì›€ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

```tsx
const apiRequesterï¼š Axioslnstance = axios .create({
baseURL: "https://api.baemin.com",
timeout: 5000,
})ï¼›
const fetchCart = ()ï¼š AxiosPromise<FetchCartResponse> =>
apiRequester.get <FetchCartResponse> ("cart");
const postCart = (postCartRequestï¼š PostCartRequest)ï¼š AxiosPromise<PostCartResponse>=>
apiRequester.post <PostCartResponse> ("cart", postCartRequest);
```

- API ì—”íŠ¸ë¦¬ê°€ 2ê°œ ì´ìƒì¼ ê²½ìš° ê° ì„œë²„ì˜ ê¸°ë³¸ URLì„ í˜¸ì¶œí•˜ë„ë¡ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë”°ë¡œ êµ¬ì„±í•  ë•Œ ìš©ì´

```tsx
const apiRequesterï¼š Axioslnstance = axios.create(defaultConfig);
const orderApiRequester: Axioslnstance = axios.create({
baseURL: "https://api.baemin .or/",
...defaultConfig,
});

const orderCartApiRequester: Axioslnstance = axios.create({
baseURLï¼š "https://cart.baemin.order/",
...defaultConfig,
)};
```

**Axios ì¸í„°ì…‰í„° ì‚¬ìš©í•˜ê¸°**

- ìš”ì²­ ì˜µì…˜ì— ë”°ë¼ ë‹¤ë¥¸ ì¸í„°ì…‰í„°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ë¹Œë” íŒ¨í„´ì„ ì¶”ê°€í•˜ì—¬ APIBuilderê°™ì€ í´ë˜ìŠ¤ í˜•íƒœë¡œ êµ¬ì„±í•˜ê¸°ë„ í•œë‹¤.

**API ì‘ë‹µ íƒ€ì… ì§€ì •í•˜ê¸°**

- ê°™ì€ ì„œë²„ì—ì„œ ì˜¤ëŠ” ì‘ë‹µì˜ í˜•íƒœëŠ” ëŒ€ì²´ë¡œ í†µì¼ë˜ì–´ìˆì–´ í•˜ë‚˜ì˜ Response íƒ€ì…ìœ¼ë¡œ ë¬¶ì¼ ìˆ˜ ìˆë‹¤.

```tsx
interface Response<T>{
data: T;
statusï¼š string;
serverDateTimeï¼š string;
errorCode?: string; // FAIL, ERROR
errorMessage?ï¼š string; // FAIL, ERROR
}

const fetchCart = 0: AxiosPromise<Response<FetchCartResponse> =>
apiRequester.get<Response<FetchCartResponseÂ» "cart";

const postCart = (postCartRequest: PostCartRequest)ï¼š AxiosPromise<Response<PostCar
tResponse> =>
apiRequester.post<Response<PostCartResponse>("cart", postCartRequest);
```

- ìœ„ì²˜ëŸ¼ ì²˜ë¦¬í•  ë•Œ Response íƒ€ì…ì„ apiRequester ì•ˆì—ì„œ ì²˜ë¦¬í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆëŠ”ë° ê·¸ëŸ¬ë©´ ì‘ë‹µì´ ì—†ì„ ìˆ˜ ìˆëŠ” ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ì²˜ë¦¬ê°€ ê¹Œë‹¤ë¡œì›Œì§„ë‹¤.
- ì¦‰ Response íƒ€ì…ì€ apiRequesterê°€ ëª¨ë¥´ê²Œ ê´€ë¦¬ë˜ì–´ì•¼í•œë‹¤.
- API ìš”ì²­ ë° ì‘ë‹µ ê°’ ì¤‘ì—ëŠ” ì–´ë–¤ ì‘ë‹µ ê°’ì´ ë“¤ì–´ìˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê±°ë‚˜ í˜•ì‹ì´ ë‹¬ë¼ì§€ë”ë¼ë„ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆëŠ”ë° ì´ë•ŒëŠ” unknown íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```tsx
interface response {
	dataï¼š {
		cartitemsï¼š Cartltem[];
		forPassï¼š unknown;
	}
}
```

- ë§Œì•½ ì´ë¯¸ ì„¤ê³„ëœ í”„ë¡œë•íŠ¸ì—ì„œ ì“°ê³  ìˆëŠ” ê°’ì´ forPassë¡œ ë„˜ì–´ì˜¤ëŠ” ê±°ë©´ ì„¤ê³„ëœ ëŒ€ë¡œ ì¨ì•¼í•˜ëŠ” ê°’ì— ëŒ€í•´ì„œë§Œ íƒ€ì…ì„ ì„ ì–¸í•˜ê³  ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.

**ë·° ëª¨ë¸(View Model) ì‚¬ìš©í•˜ê¸°**

- API ì‘ë‹µì€ ë³€í•  ê°€ëŠ¥ì„±ì´ í¬ê¸° ë•Œë¬¸ì— ë·°ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.
- ì¢‹ì€ ì»´í¬ë„ŒíŠ¸ëŠ” ë³€ê²½ë  ì´ìœ ê°€ í•˜ë‚˜ë¿ì¸ ì»´í¬ë„ŒíŠ¸
- APIê°€ ìˆ˜ì •ë¨ì— ë”°ë¼ ì‚¬ìš©ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ìˆ˜ì •ë˜ì–´ì•¼í•˜ë©´ ì¢‹ì§€ì•Šë‹¤.
- ì´ë•Œ ë·° ëª¨ë¸ì„ ë§Œë“¤ë©´ API ì‘ë‹µì´ ë°”ë€Œì–´ë„ UIê°€ ê¹¨ì§€ì§€ ì•Šê²Œ ê°œë°œí•  ìˆ˜ ìˆë‹¤.

```tsx
// ê¸°ì¡´ ListResponseì— ë” ìì„¸í•œ ì˜ë¯¸ë¥¼ ë‹´ê¸° ìœ„í•œ ë³€í™”
interface JobListltemResponse {
	nameï¼š string;
}
interface JobListResponse {
	jobitemsï¼š JobListItemResponse[];
}
class JobList {
	readonly totalltemCount: number;
	readonly items: JobListltemResponse[];.

		constructor({jobitems }: JobListResponse) {
		this.totalltemCount = jobitems.length;
		this.items = jobitems;
	}
}

const fetchJobList = async (filter?ï¼š ListFetchFilter)ï¼š Promise<JobListResponse> => {
const { data } = await api
	.params({ ...filter })
	.get('/apis/get-list-summaries')
	.call<Response<JobListResponseÂ»();

return new JobList(data);
}
```

- ë·° ëª¨ë¸ì˜ ë‹¨ì ì€ ì¶”ìƒí™” ë ˆì´ì–´ ì¶”ê°€ë¡œ ì½”ë“œë¥¼ ë³µì¡í•˜ê²Œ ë§Œë“¤ë©° ë ˆì´ì–´ë¥¼ ê´€ë¦¬í•˜ê³  ê°œë°œí•˜ëŠ”ë°ë„ ë¹„ìš©ì´ ë“¤ê²Œí•˜ëŠ” ê²ƒ
- ê¼­ í•„ìš”í•œ ë¶€ë¶„ì—ë§Œ ë·° ëª¨ë¸ì„ ë¶€ë¶„ì ìœ¼ë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ê³ , ë°±ì—”ë“œì™€ ì¶©ë¶„íˆ ì†Œí†µí•œ ë‹¤ìŒì— ê°œë°œí•˜ì—¬ API ë³€í™”ë¥¼ ì¤„ì´ê¸°, ë·° ëª¨ë¸ì— í•„ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹ ì— getter ë“±ì˜ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ì‹¤ì œ ì–´ë–¤ ê°’ì´ ë·° ëª¨ë¸ì— ì¶”ê°€í•œ ê°’ì¸ì§€ ì•Œê¸° ì‰½ê²Œí•˜ê¸° ë“±ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.

**Superstructë¥¼ ì‚¬ìš©í•´ ëŸ°íƒ€ì„ì—ì„œ ì‘ë‹µ íƒ€ì… ê²€ì¦í•˜ê¸°**

- ëŸ°íƒ€ì… API ì‘ë‹µ íƒ€ì…ì˜¤ë¥˜ëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œëŠ” ì°¾ì„ ìˆ˜ ì—†ë‹¤.
- Superstructì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ë³´ì
    - ì¸í„°í˜ì´ìŠ¤ ì •ì˜ì™€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë°ì´í„°ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤.
    - ëŸ°íƒ€ì…ì—ì„œ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí•´ ê°œë°œìì™€ ì‚¬ìš©ìì—ê²Œ ìì„¸í•œ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ê³ ì•ˆë˜ì—ˆë‹¤.

**ì‹¤ì œ API ì‘ë‹µ ì‹œì˜ Superstruct í™œìš© ì‚¬ë¡€**

> superStruct ì˜ Infer ëŠ” Object()ë¥¼ ì‚¬ìš©í•´ ë§Œë“  ê²ƒì˜ íƒ€ì…ì„ ë½‘ì•„ì£¼ëŠ” ìš©ë„
ê±°ì˜ axios ì“°ë©´ ì¢‹ë‹¤ë¼ëŠ” ë‚´ìš©, 
APIBuilder, View Model ë“± ìƒì†Œí•˜ì§€ë§Œ ì´í•´ê°€ ì–´ë µì§€ëŠ” ì•Šì•˜ë‹¤.
Response dataê°€ íƒ€ì…ì„ ëª¨ë¥´ë‹ˆ ê·¸ë•Œ ëŒ€ì²˜í•˜ëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ëŠ” ì±•í„°ì¸ë“¯
> 

## 7.2 API ìƒíƒœ ê´€ë¦¬í•˜ê¸°

- ì‹¤ì œ APIë¥¼ ìš”ì²­í•˜ëŠ” ì½”ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.

**ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ í˜¸ì¶œí•˜ê¸°**

- reduxì™€ mobx ì˜ˆì‹œ
- ëª¨ë“  ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ ì•¡ì…˜ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ê´€ë ¨ëœ ìŠ¤í† ì–´ë‚˜ ìƒíƒœê°€ ê³„ì† ëŠ˜ì–´ë‚œë‹¤.
- ì´ë¡œ ì¸í•´ ì „ì—­ ìƒíƒœ ê´€ë¦¬ìê°€ ëª¨ë“  ë¹„ë™ê¸° ìƒíƒœì— ì ‘ê·¼í•˜ê³  ë³€ê²½í•  ìˆ˜ ìˆë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤.

**í›…ìœ¼ë¡œ í˜¸ì¶œí•˜ê¸°**

- react-query ë‚˜ useSwrì´ ìˆë‹¤. ìœ„ ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë³´ë‹¤ ì‰½ë‹¤.
- ìºì‹œë¥¼ ì´ìš©í•´ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
- ì´ëŸ¬í•œ í›…ì„ ì‚¬ìš©í•˜ëŠ” ìª½ì˜ ì»´í¬ë„ŒíŠ¸ê°€ í•­ìƒ ìµœì‹  ìƒíƒœë¥¼ í‘œí˜„í•˜ë ¤ë©´ í´ë§ì´ë‚˜ ì›¹ì†Œì¼“ë“±ì˜ ë°©ë²•ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤.

<aside>
ğŸ’¡ í´ë§

í´ë¼ì´ì–¸íŠ¸ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¼ì •í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³ ï¼Œì„œë²„ëŠ” í•´ë‹¹ ìš”ì²­ì— ëŒ€í•´ ìµœì‹  ìƒíƒœì˜ ë°ì´í„°ë¥¼ ì‘ë‹µìœ¼ë¡œ ë³´ë‚´ì£¼ëŠ” ë°©ì‹ì„ ë§í•œë‹¤.

</aside>

> ë¹„ë™ê¸° ìƒíƒœê´€ë¦¬ì—ëŠ” react-qeury ë‚˜ useSwr ì“°ìëŠ” ì–˜ê¸°ê°€ ëì¸ë“¯
ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ëª… ëŠë‚Œì´ ê°•í•¨ (í´ë§ì •ë„ëŠ” ìƒˆë¡œ ì•Œì•˜ë‹¤.)
> 

## 7.3 API ì—ëŸ¬ í•¸ë“¤ë§

**íƒ€ì… ê°€ë“œ í™œìš©í•˜ê¸°**

- Axios ì˜  isAxiosError íƒ€ì… ê°€ë“œ

```tsx
interface ErrorResponse {
	status: string;
	serverDateTime: string;
	errorCode: string;
	errorMessage: string;
}

function isServerError(errorï¼š unknown)ï¼š error is AxiosError<ErrorResponse> {
	return axios.isAxiosError(error);
}
```

**ì—ëŸ¬ ì„œë¸Œí´ë˜ì‹±í•˜ê¸°**

- ì¸ì¦ ì •ë³´ ì—ëŸ¬, ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬, íƒ€ì„ ì•„ì›ƒ ì—ëŸ¬ ë“±ì„ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œí•˜ê¸° ìœ„í•´ ì„œë¸Œí´ë˜ì‹±ì„ í™œìš©
- ì„œë¸Œí´ë˜ì‹± : ê¸°ì¡´ í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ” ê³¼ì •

**ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•œ ì—ëŸ¬ ì²˜ë¦¬**

```tsx
const httpErrorHandler = (
	errorï¼š AxiosError<ErrorResponse> | Error
): Promise<Error> => {
	(error) => {
// 401 ì—ëŸ¬ì¸ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
	if (error.response && error.response .status === 401) {
	window.location.href = `${backOfficeAuthHost}/login?targetUrl=${window.
	location.href}`;
		}
		return Promise.reject(error)ï¼›
	};
};

orderApiRequester.interceptors.response.use(
	(responseï¼š AxiosResponse) => response,
	httpErrorHandler
);
```

**ì—ëŸ¬ ë°”ìš´ë”ë¦¬ë¥¼ í™œìš©í•œ ì—ëŸ¬ ì²˜ë¦¬**

- ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•  ë•Œ ê³µí†µìœ¼ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸
- ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ í•˜ìœ„ì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ë¥¼ ìºì¹˜ â†’ ê°€ì¥ ê°€ê¹Œìš´ ë¶€ëª¨ ì—ëŸ¬ ë°”ìš´ë”ë¦¬ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬

ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œì˜ ì—ëŸ¬ ì²˜ë¦¬

- Redux
- MobX

**react-qeury ë¥¼ í™œìš©í•œ ì—ëŸ¬ ì²˜ë¦¬**

```tsx
const JobComponent: React.FC = () => {
	const { isError, error, isLoading, data } = useFetchJobList();
	if (isError) {
		return <div>{'${error.message}ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'}</div>;
	}
	if (isLoading) {
		return <div>ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.</div>;
	}
	return <>{data.map(Gob) => <JobItem key={job.id} job={job} />)}</>;
};
```

**ê·¸ ë°–ì˜ ì—ëŸ¬ ì²˜ë¦¬**

- ë³´í†µ HTTP status ì½”ë“œë¥¼ ë³´ê³  ì‹¤íŒ¨ ì‘ë‹µì„ íŒë‹¨
- í•˜ì§€ë§Œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œì˜ ìœ íš¨ì„± ê²€ì¦ì— ì˜í•´ ì¶”ê°€ëœ ì»¤ìŠ¤í…€ ì—ëŸ¬ëŠ” 200 ì‘ë‹µê³¼ í•¨ê»˜ ì‘ë‹µ ë°”ë””ì— ë³„ë„ì˜ ìƒíƒœ ì½”ë“œë¥¼ ì „ë‹¬í•˜ê¸°ë„ í•¨
- 200ë²ˆ ëŒ€ì˜ ì„±ê³µ ì‘ë‹µì— ëŒ€í•œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ìˆì„ ìˆ˜ë„ ìˆë‹¤.

```tsx
httpStatus: 200
{
	"status":"C20005", // ì„±ê³µì¸ ê²½ìš° "SUCCESS"ë¥¼ ì‘ë‹µ
	"message": "ì¥ë°”êµ¬ë‹ˆì— í’ˆì ˆëœ ë©”ë‰´ê°€ ìˆìŠµë‹ˆë‹¤."
}
```

- ìœ„ ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ìš”ì²­ í•¨ìˆ˜ ë‚´ì—ì„œ ì¡°ê±´ë¬¸ìœ¼ë¡œ ìƒíƒœë¥¼ ë¹„êµ

```tsx
const successHandler = (responseï¼š CreateOrderResponse) => {
	if (response.status === "SUCCESS") {
	// ì„±ê³µ ì‹œ ì§„í–‰í•  ë¡œì§ì„ ì¶”ê°€í•œë‹¤
	return;
}

throw new CustomError(response.status, response.message);

const createOrder = (dataï¼š CreateOrderData) => {
	try {
		const response = apiRequester.post("httpsdata);
		successHandler(response);
	} catch (error) {
		errorHandler(error);
	}
};
```

- ì»¤ìŠ¤í…€ ì—ëŸ¬ì— ëŒ€í•œ ìš”ì²­ì„ ì¼ê´„ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´ Axiosë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ëŠ¥ì„ í™œìš©í•˜ì
    - axiosì˜ ê²½ìš° íŠ¹ì • í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ API requesterë¥¼ ë³„ë„ë¡œ ì„ ì–¸í•˜ê³  ìƒíƒœ ì½”ë“œ ë¹„êµ ë¡œì§ì„ ì¸í„°ì…‰í„°ì— ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

> ê° ì£¼ì œë³„ ì—ëŸ¬ì²˜ë¦¬ ë°©ë²•ì†Œê°œì— ê°€ê¹ë‹¤. 
ì „ì²´ì ì¸ ì±…ì˜ ì£¼ì œì™€ ì•½ê°„ ì–´ê¸‹ë‚˜ë³´ì´ì§€ë§Œ ìƒˆë¡œìš´ ë‚´ìš©ê³¼ ë„ì›€ì´ ë˜ëŠ” ë‚´ìš©ì´ ë§ì•„ì„œ ì¢‹ì•˜ë‹¤.
> 

## 7.4 API ëª¨í‚¹

- ì„œë²„ APIê°€ ì™„ì„±ë˜ê¸° ì „ì— í”„ë¡ íŠ¸ API í†µì‹ ì„ ê°œë°œí•˜ëŠ” ìƒí™©ì— ëŒ€ë¹„í•´ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ ë°©ë²•
- jest.fn() ê³¼ ê°™ì€ ê±¸ë¡œ  API í•¨ìˆ˜ë¥¼ ëª¨ë°©í•´ ê°œë°œí•˜ëŠ” ê²ƒ
- axios-mock-adapterë‚˜ NextApi-Handler ë“±ì´ ìˆë‹¤.

**JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°**

- ì¡°íšŒë§Œ í•„ìš”í•œ ê²½ìš°ëŠ” *.json íŒŒì¼ì„ ë§Œë“¤ê±°ë‚˜ .js ì•ˆì— JSON ì •ë³´ë¥¼ ë§Œë“¤ê³  export í•˜ëŠ” ì‹ìœ¼ë¡œ í•˜ê¸°ë„ í•œë‹¤.
- ë³„ë„ ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•Šê³  ë¹¨ë¼ ìœ ìš©í•˜ë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë‚˜ì¤‘ì— ê²½ë¡œë¥¼ ë°”ê¿”ì•¼í•œë‹¤.

**NextApiHandler í™œìš©í•˜ê¸°**

- Nextjsë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ í™œìš©í•  ìˆ˜ ìˆë‹¤.
- í•˜ë‚˜ì˜ íŒŒì¼ ì•ˆì— í•˜ë‚˜ì˜ í•¸ë“¤ëŸ¬ë¥¼ ë””í´íŠ¸ ìµìŠ¤í¬íŠ¸ë¡œ êµ¬í˜„í•´ì•¼ í•˜ë©° íŒŒì¼ì˜ ê²½ë¡œê°€ ìš”ì²­ ê²½ë¡œê°€ ëœë‹¤.

**API ìš”ì²­ í•¸ë“¤ëŸ¬ì— ë¶„ê¸° ì¶”ê°€í•˜ê¸°**

- ìš”ì²­ ê²½ë¡œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê°œë°œí•  ë•Œ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì‹¤ì œ ìš”ì²­ì„ ë³´ë‚´ê³  ê·¸ ì™¸ì—ëŠ” ëª©ì—…ì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œí•˜ê³  ì‹¶ì„ ë•Œ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ë‹¤.
- ê°œë°œì´ ì™„ë£Œëœ í›„ì—ë„ ìœ ì§€ë³´ìˆ˜í•  ë•Œ ëª©ì—…ì„ ì“¸ ìˆ˜ ìˆì–´ ì¢‹ì§€ë§Œ if ë¶„ê¸° ë“±ì„ ì¶”ê°€í•´ì•¼í•´ì„œ ë²ˆê±°ë¡­ë‹¤.

**axios-mock-adapterë¡œ ëª¨í‚¹í•˜ê¸°**

- ì„œë¹„ìŠ¤ í•¨ìˆ˜ì— ë¶„ê¸°ë¬¸ì´ ì¶”ê°€ë˜ëŠ” ê²ƒì„ ë°”ë¼ì§€ ì•Šìœ¼ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- MockAdapter ê°ì²´ë¥¼ ë§Œë“¤ê³ , ì´ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ëª¨í‚¹í•  ìˆ˜ ìˆë‹¤.

```tsx
import axios from "axios";
import MockAdapter from "axiosï¼Œock-adapteã€Œ";
import fetchOrderListSuccessResponse from "fetchOrderListSuccessResponse.j son";

interface MockResult {
	status?: number;
	delay?ï¼š number;
	use?ï¼š boolean;
}

const mock = new MockAdapter(axios, { onNoMatchï¼š "passthrough" });

export const fetchOrderListMock = () =>
	mock
	.onGet(/\/order\/list/)
	.reply(200, fetchOrderListSuccessResponse);
	

// fetchOrderListSuccessResponse.json
{
	"data": [
		{
			"orderNo": "0RDER1234"ï¼Œ
			"orderDate": "2022-02-02"J
			"shop": {
				"shopNo": "SH0P1234",
				"name": "ê°€ê²Œì´ë¦„1234"
			},
			"deliverystatus": "DELIVERY"
		}
	]
}
```

- reply ë¶€ë¶„ì„ ë³„ë„ë¡œ êµ¬í˜„í•˜ë©´ ì—¬ëŸ¬ Mockì—ì„œ ì‚¬ìš©í•˜ê¸° ì¢‹ë‹¤.

```tsx
export const lazyData = (
	statusï¼š number = Math.floor(Math.random() * 10) > 0 ? 200 : 200,
	successDataï¼š unknown = defaultSuccessData,
	failDataï¼š unknown = defaultFailData,
	time = Math.floor(Math.randomO * 1000)
)ï¼š Promise<any> =>
	new Promise((resolve) => {
		setTimeout(() => {
			resolve([status, status === 200 ? successData : failData]);
		}, time);
	})ï¼›

export const fetchOrderListMock = ({
	status = 200,
	time = 100,
	use = true
}ï¼š MockResult) =>
	use && 
	mock
		.onGet(A/orderVlist/)
		.reply(() =>
			lazyData(status, fetchOrderListSuccessResponse, undefined, time)
		);
```

- GETë¿ë§Œ ì•„ë‹ˆë¼ POST, PUT, DELETE ë„ ëœë‹¤.
- networkErrorë‚˜ timeoutErroë“±ì„ ë©”ì„œë“œë¡œ ì œê³µí•´ ì„ì˜ë¡œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ë„ ìˆë‹¤.

**ëª©ì—… ì‚¬ìš© ì—¬ë¶€ ì œì–´í•˜ê¸°**

- í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•´ ëª©ì—…ìœ¼ë¡œ ê°œë°œí•  ë•Œì™€ í•˜ì§€ ì•Šì„ ë•Œë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.

```tsx
const useMock = Object.is(REACT_APP_MOCK, "true")

const mockFn = ({ status = 200, time = 100, use = true }ï¼š MockResult) => use &&
mock.onGet(A/orderVlist/).reply(() =>
	new Promise((resolve) =>
		setTimeout(() => {
			resolve([
				status,
				status === 200 ? fetchOrderListSuccessResponse : undefined,
			]);
		}, time)
	)
);

if (useMock) {
	mockFn({ statusï¼š 200, timeï¼š 100, useï¼š true });
}
```

- ìŠ¤í¬ë¦½íŠ¸ì—ì„œ êµ¬ë¶„ ì§“ê³ ì í•œë‹¤ë©´ package.jsonì— ì¶”ê°€í•˜ë©´ ëœë‹¤.

```json
{
	"scripts: {
		"start:mock": "REACT_APP_MOCK=true npm run start",
		"start": "REACT_APP_MOCK=false npm run start",
	}
}
```

- ëª©ì—…ì„ ì‚¬ìš©í•  ë•Œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ì— ë³´ë‚¸ ìš”ì²­ì„ ë³€ê²½í•´ì£¼ëŠ” Cypress ê°™ì€ ì›¹í›…ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

## 7ì¥ ì •ë¦¬

- react-qeury ì“°ë¼ëŠ” ë§ ë¿ì¸ ê²ƒ ê°™ë‹¤.
- ì¥í™©í•˜ê²Œ ì„¤ëª…í•˜ê³  ë¹„ë™ê¸° ì—ëŸ¬ í•¸ë“¤ë§, ìƒíƒœê´€ë¦¬ ê°œë…ì§šì–´ì£¼ê³  ì½”ë“œë³´ê³  ì¢‹ì•˜ìœ¼ë‚˜, íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì— ê´€ë ¨ëœ ë‚´ìš©ì—ì„œëŠ” ë²—ì–´ë‚˜ì§€ ì•Šì•˜ë‚˜â€¦
- ì•„ëŠ”ì‚¬ëŒì´ ì§€ì‹ ì¬ì ê²€í•˜ëŠ” ëª©ì ìœ¼ë¡œ ì“°ì¸ ì±…ì¸ ëŠë‚Œì´ ê°•í•˜ë‹¤.
- axios, react-query ì´ê±° ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒë“¤ ëª¨ì„

# ë‹¤ìŒì‹œê°„ ìˆ˜ 7ì‹œ

ë‹¤ìŒ ì‹œê°„ 8, 9ì¥ ì½ì–´ì˜¤ê¸°